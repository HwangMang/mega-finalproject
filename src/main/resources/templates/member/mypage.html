<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main-layout}" th:with="activeTab='items', title='bokduck'">

<head>
<style>
    a:link { color: red; text-decoration: none;}
    a:visited { color: black; text-decoration: none;}
    a:hover { color: black; text-decoration: none;}

</style>
    <script th:inline="javascript">
        $(document).ready(function () {
            $('#nicknameButton').click(function () { //회원정보 공개 비공개로 변경
                let data = $(this).val();
                if (data == "true") {
                    $('#nicknameButton').val(false);
                    $('#nicknameButton').text("비공개");
                } else {
                    $('#nicknameButton').val(true);
                    $('#nicknameButton').text("공개");
                }
            });


            $('#out').click(function () { //!!!회원 탈퇴
                if (confirm("정말 탈퇴 하시겠습니까?")) { //팝업 창에 뜨는 글씨, 예 눌렀을때 실행됨!
                    $.ajax({
                        type: 'get',
                        url: '/memberDelete',
                        dataType: 'json',
                        success: function (result) {
                            location.href = "/";
                        }
                    });
                } else { // 아니요 눌렀을때 실행 되는거 else 꼭 써야 함!

                }
            });

            $('#button').click(function () { //정보 수정
                let newnickname = $('#newnickname').val();
                let newtel = $('#newtel').val();
                let postcode = $('#postcode').val();
                let address = $('#address').val();
                let detailAddress = $('#detailAddress').val();
                let nicknameOpen = $('#nicknameButton').val();

                if (newtel.length != 11) {
                    alert("핸드폰 번호 길이를 확인해주세요");
                    return;
                }
                $.ajax({
                    type: 'GET',
                    url: '/mypage/change',
                    data: {
                        "newnickname": newnickname,
                        "newtel": newtel,
                        "postcode": postcode,
                        "address": address,
                        "detailAddress": detailAddress,
                        "nicknameOpen": nicknameOpen
                    },
                    dataType: 'json',
                    success: function (result) {
                        alert(result.message);
                    }
                });

            });

        });

    </script>
</head>
<body>
<div layout:fragment="content">
    <!--    내 정보 -->
    <div class="container">
        <main>
            <div class="py-5 text-left">
                <h2>내 정보</h2>
            </div>

            <div class="justify-content-center">
                <div class="form-group row">
                    <label class="col-sm-2 col-form-label"><span style="font-weight: bold">이메일</span></label>
                    <div class="col-sm-1"> |</div>
                    <div class="col-sm-5">
                        <input type="text" readonly class="form-control" style="font-weight: bold"
                               th:value="${member.username}">
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-2 col-form-label"><span style="font-weight: bold">닉네임</span></label>
                    <div class="col-sm-1"> |</div>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" th:id="newnickname" th:value="${member.nickname}">
                    </div>
                    <div class="col-sm-2">
                        <button th:text="${member.nicknameOpen == true}? '공개' : '비공개'" class="form-control"
                                th:id="nicknameButton"
                                th:value="${member.nicknameOpen}"></button>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-2 col-form-label"><span style="font-weight: bold">비밀번호 변경</span></label>
                    <div class="col-sm-1"> |</div>
                    <div class="col-sm-5">
                        <a class="btn btn-warning" th:href="@{/password/change}" role="button">비밀번호 변경</a><br>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-2 col-form-label"><span style="font-weight: bold">연락처 변경</span></label>
                    <div class="col-sm-1"> |</div>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" th:value="${member.tel}" th:id="newtel"
                               onKeyup="this.value=this.value.replace(/[^0-9]/g,'');">
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-2 col-form-label"><span style="font-weight: bold">주소 변경</span></label>
                    <div class="col-sm-1"> |</div>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" name="postcode"
                               th:value="${member.userAddress?.postcode}" id="postcode"
                               placeholder="우편번호">
                    </div>
                    <div class="col-sm-2">
                        <input type="button" onclick="execDaumPostcode()" class="form-control" value="우편번호 찾기"><br>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-2 col-form-label"></label>
                    <div class="col-sm-1"></div>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" name="address"
                               th:value="${member.userAddress?.baseAddress}" id="address"
                               placeholder="주소">
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-2 col-form-label"></label>
                    <div class="col-sm-1"></div>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" name="detailAddress"
                               th:value="${member.userAddress?.detailAddress}"
                               id="detailAddress" placeholder="상세주소">
                    </div>
                    <div class="col-sm-3">
                        <input type="text" name="extraAddress" id="extraAddress" placeholder="참고항목" disabled>
                    </div>
                </div>


                <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
                <script>
                    function execDaumPostcode() {
                        new daum.Postcode({
                            oncomplete: function (data) {
                                contentType: 'application/json'
                                var addr = ''; // 주소 변수
                                var extraAddr = ''; // 참고항목 변수

                                //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                                    addr = data.roadAddress;
                                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                                    addr = data.jibunAddress;
                                }

                                // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                                if (data.userSelectedType === 'R') {
                                    // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                                    // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                                    if (data.bname !== '' && /[동|로|가]$/g.test(data.bname)) {
                                        extraAddr += data.bname;
                                    }
                                    // 건물명이 있고, 공동주택일 경우 추가한다.
                                    if (data.buildingName !== '' && data.apartment === 'Y') {
                                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                                    }
                                    // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                                    if (extraAddr !== '') {
                                        extraAddr = ' (' + extraAddr + ')';
                                    }
                                    // 조합된 참고항목을 해당 필드에 넣는다.
                                    document.getElementById("extraAddress").value = extraAddr;

                                } else {
                                    document.getElementById("extraAddress").value = '';
                                }

                                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                                document.getElementById('postcode').value = data.zonecode;
                                document.getElementById("address").value = addr;
                                // 커서를 상세주소 필드로 이동한다.
                                document.getElementById("detailAddress").focus();
                            }
                        }).open();
                    }
                </script>

                <div class="row g-2 justify-content-left">
                    <button type="submit" class="w-10 btn btn-lg btn-info" th:id="button">변경</button>
                </div>

                <hr class="col-12 my-4">

<!--                !!!!!!!!!!!!!!!내가 쓴글 여기에 쓰면 될듯?-->

                <!--    로그아웃, 회원 탈퇴 기능-->
                <div class="py-5 text-center">
                    <button style="background-color: transparent; border: 0; outline: 0;"><a href="/logout">
                        <span>로그아웃&nbsp;&nbsp;|&nbsp;&nbsp;</span></a></button>
                    <button th:id="out"style="background-color: transparent; border: 0; outline: 0;">
                        <span> 회원탈퇴</span></button>
                </div>



            </div>
        </main>
    </div>


</div>
</body>
</html>